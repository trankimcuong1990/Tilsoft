@using Frontend.Helper;
@{
    ViewBag.Title = "Factory Quotation";
    ViewBag.Icon = "fa-search";
    Frontend.APIDTO.APIUserInformation userInfo = (Frontend.APIDTO.APIUserInformation)ViewBag.CurrentLoginUserInfo;
    int userID = userInfo.Data.UserId;
    var serviceReport = System.Configuration.ConfigurationManager.AppSettings["BackendReportUrl"];

    string autoArtCode = string.Empty;
    string autoSeason = string.Empty;
    string autoOverdue = "null";
    string autoWaitStatus = "null";
    string autoStatus = "null";
    string autoType = "null";

    string userManualUrl = string.Empty;
    if (System.IO.File.Exists(Server.MapPath("~/UserManual/" + ViewBag.ModuleCode + ".pdf")))
    {
        userManualUrl = "/UserManual/" + ViewBag.ModuleCode + ".pdf";
    }
    if (Request.Params.AllKeys.Contains("articleCode"))
    {
        autoArtCode = Request.Params["articleCode"].ToString();
    }
    if (Request.Params.AllKeys.Contains("season"))
    {
        autoSeason = Request.Params["season"].ToString();
    }
    if (Request.Params.AllKeys.Contains("overdue"))
    {
        autoOverdue = Request.Params["overdue"].ToString();
        if (!string.IsNullOrEmpty(autoOverdue))
        {
            autoOverdue = (autoOverdue == "1") ? "1" : "0";
        }
        else
        {
            autoOverdue = "null";
        }
    }
    if (Request.Params.AllKeys.Contains("wait"))
    {
        autoWaitStatus = Request.Params["wait"].ToString();
        if (!string.IsNullOrEmpty(autoWaitStatus))
        {
            autoWaitStatus = (autoWaitStatus == "2") ? "2" : "1";
        }
        else
        {
            autoWaitStatus = "null";
        }
    }
    if (Request.Params.AllKeys.Contains("status"))
    {
        autoStatus = Request.Params["status"].ToString();
        if (!string.IsNullOrEmpty(autoStatus))
        {
            autoStatus = (autoStatus == "1") ? "1" : "3";
        }
        else
        {
            autoStatus = "null";
        }
    }
    if (Request.Params.AllKeys.Contains("type"))
    {
        autoType = Request.Params["type"].ToString();
        if (string.IsNullOrEmpty(autoType))
        {
            autoType = "null";
        }
    }
}

<style>
    select.business-data-options option[value='number:1'] {
        background-color: #ececec;
    }

    select.business-data-options option[value='number:2'] {
        background-color: #ffffab;
    }

    select.business-data-options option[value='number:3'] {
        background-color: #cab1ff;
    }

    select.business-data-options option[value='number:4'] {
        background-color: #bfe7ff;
    }

    /*.tilsoft-table-wrapper,
    .tilsoft-table .tilsoft-table-header div,
    .tilsoft-table .tilsoft-table-filter div,
    .tilsoft-table .tilsoft-table-totalrow div,
    .tilsoft-table .tilsoft-table-subtotalrow div,
    .tilsoft-table .tilsoft-table-body table td,
    .tilsoft-table-wrapper a.btn,
    .tilsoft-table-body table tr td, .tilsoft-table-header > div {
        font-size: 10px;
    }

        .tilsoft-table-wrapper input[type=text] {
            font-size: 10px;
            height: auto;
        }*/

    .tilsoft-table .tilsoft-table-filter div select, .tilsoft-table .tilsoft-table-filter div input[type="text"], .tilsoft-table .tilsoft-table-filter div label {
        width: 100%;
    }

    .tilsoft-table-body table tr td label, .tilsoft-table-header > div > label {
        width: 100%;
        cursor: pointer;
    }

    .tilsoft-table-header, .tilsoft-table-filter, .tilsoft-table-body {
        width: 1900px;
    }

        .tilsoft-table-header > div {
            height: 75px !important;
            text-align: center !important;
        }

    .tilsoft-table-filter {
        margin-top: 75px !important;
    }

    .tilsoft-table .tilsoft-table-filter div {
        height: 40px;
    }

    .tilsoft-table-body {
        margin-top: 75px !important;
    }

        .tilsoft-table-header > div:nth-child(1),
        .tilsoft-table-filter > div:nth-child(1),
        .tilsoft-table-body table > tbody > tr > td:nth-child(1) {
            width: 65px;
            text-align: center;
        }

        /*.tilsoft-table-header > div:nth-child(2),
        .tilsoft-table-filter > div:nth-child(2),
        .tilsoft-table-body table > tbody > tr > td:nth-child(2) {
            width: 25px;
            text-align: center;
        }*/

        .tilsoft-table-header > div:nth-child(2),
        .tilsoft-table-filter > div:nth-child(2),
        .tilsoft-table-body table > tbody > tr > td:nth-child(2) {
            width: 80px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(3),
        .tilsoft-table-filter > div:nth-child(3),
        .tilsoft-table-body table > tbody > tr > td:nth-child(3) {
            width: 35px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(4),
        .tilsoft-table-filter > div:nth-child(4),
        .tilsoft-table-body table > tbody > tr > td:nth-child(4) {
            width: 60px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(5),
        .tilsoft-table-filter > div:nth-child(5),
        .tilsoft-table-body table > tbody > tr > td:nth-child(5) {
            width: 40px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(6),
        .tilsoft-table-filter > div:nth-child(6),
        .tilsoft-table-body table > tbody > tr > td:nth-child(6) {
            width: 60px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(7),
        .tilsoft-table-filter > div:nth-child(7),
        .tilsoft-table-body table > tbody > tr > td:nth-child(7) {
            width: 350px;
            text-align: left;
        }

        .tilsoft-table-header > div:nth-child(8),
        .tilsoft-table-filter > div:nth-child(8),
        .tilsoft-table-body table > tbody > tr > td:nth-child(8) {
            width: 40px;
            text-align: right;
        }

        .tilsoft-table-header > div:nth-child(9),
        .tilsoft-table-filter > div:nth-child(9),
        .tilsoft-table-body table > tbody > tr > td:nth-child(9) {
            width: 40px;
            text-align: right;
        }

        .tilsoft-table-header > div:nth-child(10),
        .tilsoft-table-filter > div:nth-child(10),
        .tilsoft-table-body table > tbody > tr > td:nth-child(10) {
            width: 40px;
            text-align: right;
        }

        .tilsoft-table-header > div:nth-child(11),
        .tilsoft-table-filter > div:nth-child(11),
        .tilsoft-table-body table > tbody > tr > td:nth-child(11) {
            width: 50px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(12),
        .tilsoft-table-filter > div:nth-child(12),
        .tilsoft-table-body table > tbody > tr > td:nth-child(12) {
            width: 50px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(13),
        .tilsoft-table-filter > div:nth-child(13),
        .tilsoft-table-body table > tbody > tr > td:nth-child(13) {
            width: 65px;
            text-align: right;
        }

        .tilsoft-table-header > div:nth-child(14),
        .tilsoft-table-filter > div:nth-child(14),
        .tilsoft-table-body table > tbody > tr > td:nth-child(14) {
            width: 65px;
            text-align: right;
        }

        .tilsoft-table-header > div:nth-child(15),
        .tilsoft-table-filter > div:nth-child(15),
        .tilsoft-table-body table > tbody > tr > td:nth-child(15) {
            width: 70px;
        }

        .tilsoft-table-header > div:nth-child(16),
        .tilsoft-table-filter > div:nth-child(16),
        .tilsoft-table-body table > tbody > tr > td:nth-child(16) {
            width: 70px;
        }

        .tilsoft-table-header > div:nth-child(17),
        .tilsoft-table-filter > div:nth-child(17),
        .tilsoft-table-body table > tbody > tr > td:nth-child(17) {
            width: 40px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(18),
        .tilsoft-table-filter > div:nth-child(18),
        .tilsoft-table-body table > tbody > tr > td:nth-child(18) {
            width: 65px;
            text-align: right;
        }


        .tilsoft-table-header > div:nth-child(19),
        .tilsoft-table-filter > div:nth-child(19),
        .tilsoft-table-body table > tbody > tr > td:nth-child(19) {
            width: 50px;
            text-align: left;
        }

        .tilsoft-table-header > div:nth-child(20),
        .tilsoft-table-filter > div:nth-child(20),
        .tilsoft-table-body table > tbody > tr > td:nth-child(20) {
            width: 80px;
            text-align: left;
        }

        .tilsoft-table-header > div:nth-child(21),
        .tilsoft-table-filter > div:nth-child(21),
        .tilsoft-table-body table > tbody > tr > td:nth-child(21) {
            width: 75px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(22),
        .tilsoft-table-filter > div:nth-child(22),
        .tilsoft-table-body table > tbody > tr > td:nth-child(22) {
            width: 90px;
            text-align: center;
        }

        .tilsoft-table-header > div:nth-child(23),
        .tilsoft-table-filter > div:nth-child(23),
        .tilsoft-table-body table > tbody > tr > td:nth-child(23) {
            width: 90px;
            text-align: center;
        }
</style>

<div class="row">
    <article class="col-sm-12">
        <div class="jarviswidget" id="pnlSearchResult" data-widget-deletebutton="false" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-togglebutton="false">
            <header>
                <span class="widget-icon"> <i class="fa fa-search txt-color-darken"></i> </span>
                <h2>Search Result</h2>
            </header>
            <div class="no-padding">
                <div class="widget-body" style="padding-bottom: 0px;">
                    <div class="form-inline dt-bootstrap no-footer tilsoft-table-wrapper">
                        <div class="dt-toolbar" style="padding: 10px; border: solid 1px #ddd; border-bottom: none; box-sizing: border-box; z-index: 101; font-size: 12px;">
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <a href="javascript:void(0)" class="btn btn-success btn-xs" ng-click="event.updateTarget()"><i class="fa fa-save"></i> Update Price</a>
                                    <a href="javascript:void(0)" class="btn btn-default btn-xs" onclick="$('#pnlWaitForFactory').show()"><i class="fa fa-info"></i> Wait For Factory Conclusion</a>
                                    <a href="javascript:void(0)" class="btn btn-success btn-xs" ng-click="event.exportExcel()"><i class="fa fa-file-excel-o"></i> Export Excel</a>
                                    <a href="#" class="btn btn-success btn-xs" ng-click="importFromExcel.importExcel()"><i class="fa fa-file-excel-o"></i> Import Excel</a>
                                    @*<a href="javascript:void(0)" class="btn btn-primary" ng-click="event.confirmPrice()"><i class="fa fa-thumbs-o-up"></i> Confirm Price</a>
                <a href="javascript:void(0)" class="btn btn-warning" ng-click="event.unConfirmPrice()"><i class="fa fa-thumbs-o-down"></i> Reset Confirm Status</a>*@
                                </div>
                                <div ng-if="status.isLoaded">
                                    <div class="col-xs-12 col-sm-6" style="text-align: right;">
                                        <strong>Items</strong>&nbsp;
                                        <span class="label label-default">Total: {{status.total | number}}</span>
                                        <span class="label label-success">Confirmed: {{status.confirmed | number}}</span>
                                        <span class="label label-warning">Pending: {{status.pending | number}}</span>
                                        (
                                        <span class="label label-default" style="background: #afdc7e; color: #000 !important;">Eurofar: {{status.waitEurofar | number}}</span>
                                        <span class="label label-default" style="background: #ffe699; color: #000 !important;">Factory: {{status.waitFactory | number}}</span>
                                        )

                                        <br />

                                        <strong>Containers</strong>&nbsp;
                                        <span class="label label-default">Total: {{status.totalContainer | number:1}}</span>
                                        <span class="label label-success">Confirmed: {{status.totalConfirmedContainer | number:1}}</span>
                                        <span class="label label-warning">Pending: {{status.totalPendingContainer | number:1}}</span>
                                        (
                                        <span class="label label-default" style="background: #afdc7e; color: #000 !important;">Eurofar: {{status.totalContainerWaitForEurofar | number:1}}</span>
                                        <span class="label label-default" style="background: #ffe699; color: #000 !important;">Factory: {{status.totalContainerWaitForFactory | number:1}}</span>
                                        )
                                    </div>
                                </div>
                                <div ng-if="status.isLoaded === false" class="data-loading">loading...</div>
                            </div>

                            <div id="pnlWaitForFactory" class="row">
                                <div class="col-xs-6 col-sm-12">
                                    <h3>Wait for factory conclusion <a href="javascript:void(0)" class="btn btn-default btn-xs" onclick="$('#pnlWaitForFactory').hide()">Close</a></h3>
                                </div>
                                <div class="col-xs-6 col-sm-6">
                                    <table class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th colspan="7" style="text-align: center;">OFFER ITEM</th>
                                            </tr>
                                            <tr>                                             
                                                <th rowspan="2" style="vertical-align: middle; text-align: center;">FACTORY</th>                                            
                                                <th rowspan="2" style="vertical-align: middle; text-align: center;">PENDING</th>
                                                <th colspan="5" style="vertical-align: middle; text-align: center;">OVERDUE</th>
                                            </tr>
                                            <tr>
                                                <th style="vertical-align: middle; text-align: center;">TOTAL</th>
                                                <th style="vertical-align: middle; text-align: center;">1 day</th>
                                                <th style="vertical-align: middle; text-align: center;">2 day</th>
                                                <th style="vertical-align: middle; text-align: center;">3 day</th>
                                                <th style="vertical-align: middle; text-align: center;">4 day or more</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>&nbsp;</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.totalPendingItem | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.totalItem | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.overDue1Day | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.overDue2Day | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.overDue3Day | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryConlusionSummary.overDue4DayOrMore | number}}</td>
                                            </tr>
                                            <tr ng-repeat="item in status.waitForFactoryConlusion">                                             
                                                <td style="text-align: center;">{{item.factoryUD}}</td>                                              
                                                <td style="text-align: right;">{{item.totalPendingItem | number}}</td>
                                                <td style="text-align: right;">{{item.totalItem | number}}</td>
                                                <td style="text-align: right;">{{item.overDue1Day | number}}</td>
                                                <td style="text-align: right;">{{item.overDue2Day | number}}</td>
                                                <td style="text-align: right;">{{item.overDue3Day | number}}</td>
                                                <td style="text-align: right;">{{item.overDue4DayOrMore | number}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-xs-6 col-sm-6">
                                    <table class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th colspan="8" style="text-align: center;">PRODUCTION ITEM</th>
                                            </tr>
                                            <tr>                                               
                                                <th rowspan="2" style="vertical-align: middle; text-align: center;">FACTORY</th>                                             
                                                <th rowspan="2" style="vertical-align: middle; text-align: center;">PENDING</th>
                                                <th colspan="6" style="vertical-align: middle; text-align: center;">DAYS TILL LDS</th>
                                            </tr>
                                            <tr>
                                                <th style="vertical-align: middle; text-align: center;">Over LDS</th>
                                                <th style="vertical-align: middle; text-align: center;">LDS</th>
                                                <th style="vertical-align: middle; text-align: center;">1-2 days</th>
                                                <th style="vertical-align: middle; text-align: center;">3-4 days</th>
                                                <th style="vertical-align: middle; text-align: center;">5-6 days</th>
                                                <th style="vertical-align: middle; text-align: center;">7 days or more</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>&nbsp;</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.totalPendingItem | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.overLDS | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.lds | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.oneToTwoDays | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.threeToFourDays | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.fiveToSixDays | number}}</td>
                                                <td style="text-align: right; font-weight: bold;">{{status.waitForFactoryProductionConlusionSummary.moreThanSixDays | number}}</td>
                                            </tr>
                                            <tr ng-repeat="item in status.waitForFactoryProductionConlusion">                                                
                                                <td style="text-align: center;">{{item.factoryUD}}</td>                                             
                                                <td style="text-align: right;">{{item.totalPendingItem | number}}</td>
                                                <td style="text-align: right;">{{item.overLDS | number}}</td>
                                                <td style="text-align: right;">{{item.lds | number}}</td>
                                                <td style="text-align: right;">{{item.oneToTwoDays | number}}</td>
                                                <td style="text-align: right;">{{item.threeToFourDays | number}}</td>
                                                <td style="text-align: right;">{{item.fiveToSixDays | number}}</td>
                                                <td style="text-align: right;">{{item.moreThanSixDays | number}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12 col-sm-12">
                                    Season
                                    <select class="search-filter" ng-model="filters.Season" ng-options="item.seasonValue as item.seasonText for item in seasons"></select>
                                    &nbsp;

                                    P/I
                                    <input class="search-filter" type="text" ng-model="filters.ProformaInvoiceNo" />
                                    &nbsp;

                                    Client
                                    <input class="search-filter" type="text" ng-model="filters.ClientUD" />
                                    &nbsp;

                                    Type
                                    <select class="search-filter" ng-model="filters.ItemTypeID" ng-options="item.id as item.name for item in itemTypes">
                                        <option></option>
                                    </select>
                                    &nbsp;

                                    Description
                                    <input class="search-filter" type="text" ng-model="filters.Description" />
                                    &nbsp;

                                    Factory
                                    <input class="search-filter" type="text" ng-model="filters.FactoryUD" />
                                    &nbsp;

                                    Status
                                    <select class="search-filter" ng-model="filters.StatusID" ng-options="item.quotationStatusID as item.quotationStatusNM for item in quotationStatuses">
                                        <option></option>
                                    </select>
                                    <br />

                                    Wait Status
                                    <select class="search-filter" ng-model="filters.QuotationOfferDirectionID" ng-options="item.id as item.name for item in waitStatuses">
                                        <option></option>
                                    </select>
                                    &nbsp;

                                    Business data status
                                    <select class="search-filter business-data-options" ng-model="filters.BusinessDataStatusID" ng-options="item.id as item.name for item in businessDataStatuses">
                                        <option></option>
                                    </select>
                                    &nbsp;

                                    Overdue
                                    <select class="search-filter" ng-model="filters.IsDeadLine" ng-options="item.id as item.name for item in deadLines">
                                        <option></option>
                                    </select>
                                    &nbsp;

                                    Repeat Item
                                    <select class="search-filter" ng-model="filters.IsRepeatItem" ng-options="item.id as item.name for item in repeatItems">
                                        <option></option>
                                    </select>
                                    &nbsp;

                                    <a href="javascript:void(0)" class="btn btn-primary btn-xs" title="Apply Filter" ng-click="event.reload()"><i class="fa fa-filter"></i> Apply Filter</a>
                                    <a href="javascript:void(0)" class="btn btn-default btn-xs" title="Clear Filter" ng-click="event.clear()"><i class="fa fa-ban"></i> Clear Filter</a>
                                </div>
                            </div>
                        </div>
                        <div avs-scrollable-table class="tilsoft-table-wrapper" ng-load-next-page="event.loadMore()" ng-sort-data="event.sort">
                            <div class="tilsoft-table">
                                <div class="tilsoft-table-header">
                                    <div><strong>Found</strong>: {{totalRows}}</div>
                                    @*<div style="padding: 8px 0px;"><label><input type="checkbox" ng-model="data.isSelectAll" ng-change="event.toggleSelectAll()" /></label></div>*@
                                    <div class="sorting" data-colname="Season" style="width:40px">Sea son</div>
                                    <div class="sorting" data-colname="ProformaInvoiceNo" style="width:60px">P/I</div>
                                    <div class="sorting" data-colname="ClientNM">Client</div>
                                    <div class="sorting" data-colname="ItemTypeID">Ty pe</div>
                                    <div class="" data-colname="">Image</div>
                                    <div class="sorting" data-colname="Description">Description</div>
                                    <div class="sorting" data-colname="OrderQnt">Qnt</div>
                                    <div class="sorting" data-colname="Qnt40HC">Qnt / 40HC</div>
                                    <div class="sorting" data-colname="OrderQnt40HC">40HC Qnt</div>
                                    <div class="sorting" data-colname="FactoryUD">Fac tory</div>
                                    <div class="sorting" data-colname="LDS">LDS</div>
                                    <div class="sorting" data-colname="PurchasingPrice">Fac tory Price</div>
                                    <div class="sorting" data-colname="TargetPrice">Tar get Price</div>
                                    <div>New Factory</div>
                                    <div>New Comment</div>
                                    <div class="sorting" data-colname="QuotationStatusNM">Sta tus</div>
                                    <div class="sorting" data-colname="QuotationOfferDirectionID">Wait Sta tus</div>
                                    <div class="sorting" data-colname="Remark">Re mark</div>
                                    <div class="sorting" data-colname="PackagingMethodNM">Pac kaging</div>                                  
                                    <div class="sorting" data-colname="RequestedDate">Requested Date</div>
                                    <div class="sorting" data-colname="QuotedDeadline">Quoted Deadline</div>
                                    <div class="sorting" data-colname="OverDeadLine" style="width:70px">Over<br /> DeadLine</div>
                                    <div class="" data-colname="Repeat">Repeat</div>
                                    <div>  &nbsp;  </div>

                                </div>
                                <div class="tilsoft-table-body">
                                    <table>                                        
                                        <tr ng-repeat="item in data" ng-style="{'background-color': (item.isDeadline && (item.purchasingPrice === '' || item.purchasingPrice === null)) ? '#fcb9b9' : '#ffffff'}"
                                            style="background-color: {{method.getRowBackgroundColor(item)}};">
                                            <td>
                                                @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("ProductOverviewRpt", Frontend.Helper.ActionEnum.Read, HttpContext.Current) != "disabled")
                                                {
                                                    <a style="width: 30px;" ng-if="item.factoryOrderDetailID" href="@Url.Action("PriceCompare", "ProductOverviewRpt", new { id = UrlParameter.Optional })/{{item.factoryOrderDetailID}}" target="_blank" class="btn btn-default btn-xs" title="Compare"><i class="fa fa-exchange"></i></a>
                                                    <br />
                                                }
                                                <a style="width: 30px;margin-top:5px" ng-if="item.quotationStatusNM=='PENDING' && item.itemTypeID === 5" ng-click="event.reject(item.quotationDetailID)" class="btn btn-default btn-xs" title="Reject"><i class="fa fa-reply"></i></a>
                                                <br />
                                                @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("BreakDownMng", Frontend.Helper.ActionEnum.Update, HttpContext.Current) != "disabled")
                                                {
                                                    @*<a target="_blank" style="margin-top: 5px;" ng-if="item.offerLineID || item.modelID" href="@Url.Action("Edit", "BreakDownMng", new { id = UrlParameter.Optional })/0?modelId={{item.modelID}}&sampleProductId=0&offerLineId={{item.offerLineID}}&factoryId={{item.factoryID}}" class="btn btn-primary btn-xs" title="Breakdown"><i class="fa fa-cubes"></i></a>*@

                                                    <a target="_blank" style="margin-top: 5px;" ng-if="item.offerSeasonDetailID" href="@Url.Action("Edit", "BreakDownMng", new { id = UrlParameter.Optional })/0?modelId=0&sampleProductId=0&offerSeasonDetailId={{item.offerSeasonDetailID}}&factoryId={{item.factoryID}}" class="btn btn-primary btn-xs" title="Breakdown"><i class="fa fa-cubes"></i></a>
                                                }

                                                <a target="_blank" style="margin-top: 5px; width: 28px;" ng-if="item.offerSeasonDetailID" href="@Url.Action("View", "BreakDownMng", new { id = UrlParameter.Optional })/0?modelId=0&sampleProductId=0&offerSeasonDetailId={{item.offerSeasonDetailID}}&factoryId={{item.factoryID}}" class="btn btn-success btn-xs" title="Breakdown View"><i class="fa fa-eye"></i></a>
                                            </td>
                                            @*<td><label><input type="checkbox" ng-model="item.isSelected" /></label></td>*@
                                            <td style="width:40px">{{event.seasonShortCut(item.season)}}</td>
                                            <td style="width:60px">{{item.proformaInvoiceNo}}</td>
                                            <td>
                                                <strong>{{item.clientUD}}</strong>
                                                <br />
                                                {{item.clientNM}}
                                                <br />
                                                <a href="javascript:void(0)" data-toggle="modal" ng-click="event.openAdditional(item)">Addition Condition</a>
                                            </td>
                                            <td>
                                                {{item.itemTypeID === 1 ? 'F/O PRODUCT' : ''}}
                                                {{item.itemTypeID === 0 ? 'F/O SPAREPART' : ''}}
                                                {{item.itemTypeID === 6 ? 'F/O SAMPLE' : ''}}
                                                {{item.itemTypeID === 5 ? 'OFFER ITEM' : ''}}
                                                {{item.itemTypeID === 2 ? 'OFFER SAMPLE' : ''}}
                                                {{item.itemTypeID === 7 ? 'OFFER ITEM (Estimated)' : ''}}
                                                {{item.itemTypeID === 3 ? 'CATALOGUE ITEM' : ''}}
                                                {{item.itemTypeID === 4 ? 'REQUESTED ITEM' : ''}}
                                            </td>
                                            <td>
                                                <a href="{{item.fileLocation}}" data-featherlight="image">
                                                    <img style="width: 95%;" ng-src="{{item.thumbnailLocation}}" />
                                                </a>
                                            </td>
                                            <td>
                                                <strong>{{item.articleCode}}</strong>
                                                <br />
                                                {{item.description}}
                                            </td>
                                            <td>{{item.orderQnt | number}}</td>
                                            <td>{{item.qnt40HC | number}}</td>
                                            <td>{{item.orderQnt40HC | number:2}}</td>
                                            <td>{{item.factoryUD}}</td>
                                            <td>{{item.lds}}</td>
                                            <td ng-if="item.itemTypeID !== 7">
                                                <a href="javascript:void(0)" ng-click="event.openHistory(item)" style="font-weight: bold;">{{item.purchasingPrice | currency:'$':2}}</a>
                                            </td>
                                            <td ng-if="item.itemTypeID === 7">
                                                {{item.purchasingPrice | currency:'$':2}}
                                            </td>
                                            <td ng-if="item.itemTypeID !== 7">
                                                <a href="javascript:void(0)" ng-click="event.openHistory(item)">{{item.targetPrice | currency:'$':2}}</a>
                                            </td>
                                            <td ng-if="item.itemTypeID === 7">
                                                {{item.targetPrice | currency:'$':2}}
                                            </td>                                         
                                            <td><input type="text" ng-disabled="item.quotationStatusNM=='CONFIRMED' || item.itemTypeID===7" avs-currency-2 ng-model="item.newPurchasingPrice" style="text-align: right;" /></td>
                                            <td><input type="text" ng-disabled="item.itemTypeID===7" ng-model="item.newPurchasingComment" /></td>
                                            <td>
                                                <strong>{{item.quotationStatusNM}}</strong>
                                                <br />
                                                <a ng-if="item.statusUpdatedBy" href="@Url.Action("Detail", "EmployeeMng", new { id = UrlParameter.Optional })/{{item.statusUpdatedBy}}" data-featherlight="iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="800" data-featherlight-iframe-height="600">
                                                    {{item.statusUpdatorNM}}
                                                </a>
                                            </td>
                                            <td style="background-color: {{item.quotationOfferDirectionID === 1 ? '#afdc7e' : (item.quotationOfferDirectionID === 2 ? '#ffe699' : '')}};">
                                                {{item.quotationOfferDirectionID === 1 ? 'WAIT FOR EUROFAR' : (item.quotationOfferDirectionID === 2 ? 'WAIT FOR FACTORY' : '')}}
                                            </td>
                                            <td>{{item.remark}}</td>
                                            <td>{{item.packagingMethodNM}}</td>
                                            <td>{{item.requestedDate}}</td>
                                            <td>{{item.quotedDeadline}}</td>
                                            <td style="width:70px;text-align:right">{{item.overDeadLine}}</td>
                                            <td style="width:80px;text-align:center">
                                                {{item.isRepeatItem ? 'YES' : 'NO'}}
                                            </td>
                                            <td></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </article>
</div>

<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="frmHistory" class="modal fade">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="margin-top:90px !important">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                    ×
                </button>
                <h4 class="modal-title">Offer History</h4>
            </div>
            <div class="modal-body smart-form" style="padding: 0px;">
                <div>
                    <div class="widget-body">
                        <table class="table table-bordered table-striped" style="box-sizing: border-box;">
                            <thead>
                                <tr>
                                    <th>Offer Direction</th>
                                    <th>Factory Price</th>
                                    <th>Remark</th>
                                    <th>Updated By</th>
                                    <th>Updated Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in historyData">
                                    <td>{{item.quotationOfferDirectionNM}}</td>
                                    <td style="text-align: right;">{{item.price | currency:'$':2}}</td>
                                    <td>{{item.remark}}</td>
                                    <td>
                                        <a ng-if="item.userID" href="@Url.Action("Detail", "EmployeeMng", new { id = UrlParameter.Optional })/{{item.userID}}" data-featherlight="iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="800" data-featherlight-iframe-height="600">
                                            {{item.updatorNM}}
                                        </a>
                                    </td>
                                    <td>{{item.updatedDate}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="frmAdditionCondition" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content"style="width:900px" >
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Additional Condition</h4>
            </div>
            <div class="modal-body">
                <div>
                    <div class="widget-body">
                        <table class="table table-bordered table-striped" style="box-sizing: border-box;">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Selected</th>
                                    <th>Type</th>
                                    <th>Name</th>
                                    <th>Detail</th>
                                    <th>Remark</th>
                                    <th>File Attach</th>
                                    <th>Tracking</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in clientAdditionalConditionData">
                                    <td style="vertical-align:middle; text-align:center">
                                        {{$index+1}}
                                    </td>
                                    <td style=" text-align:center">
                                        <input disabled type="checkbox" ng-model="item.isSelected" />
                                    </td>
                                    <td style="text-align: center;">{{item.additionalConditionTypeNM}}</td>
                                    <td>
                                        {{item.additionalConditionNM}}
                                    </td>
                                    <td>
                                        {{item.remark}}
                                    </td>
                                    <td>
                                        {{item.remarkClient}}
                                    </td>
                                    <td class="ws-readonly">
                                        <a href="{{item.attachFileURL}}" target="_blank">
                                            {{item.attachFileFriendlyName}}
                                        </a>
                                    </td>
                                    <td>
                                        Selected by:<a ng-if="item.isSelected==true">{{item.updateName1}}</a> | <a ng-if="item.isSelected==true">{{item.updatedCheckDate}}</a>
                                        <br />
                                        UnSelected by:<a ng-if="item.isSelected==false && item.updatedUnCheckDate!=null"> {{item.updateName2}}</a> | <a ng-if="item.isSelected==false && item.updateName2!=null"> {{item.updatedUnCheckDate}}</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

@section FormAction {
<ul id="sparks">
    <li>
        <a href="javascript:void(0)" class="btn btn-default" title="Search" ng-click="event.reload()"><i class="fa fa-refresh"></i></a>
    </li>
    <li>
        <a href="javascript:void(0)" class="btn btn-default disabled" title="Export excel"><i class="fa fa-file-excel-o"></i></a>
    </li>
    @if (!string.IsNullOrEmpty(userManualUrl))
    {
        <li class="sparks-info">
            <a target="_blank" href="@userManualUrl" class="btn btn-default" title="Help"><i class="fa fa-info"></i></a>
        </li>
    }
</ul>
}

@section pagejs {
    <script src="~/Angular/app/jsonService.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
    <script src="~/Angular/app/support/service.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
    <script type="text/javascript">
        var context = {
            serviceUrl: '@(System.Configuration.ConfigurationManager.AppSettings["BackendServiceUrl"])api/factory-quotation-2/',
            serviceReport: '@serviceReport',
            token : '@Session[Frontend.Customize.Common.ProjectDefinition.TOKEN_SESSION]',
            pageSize: 20,
            userID: @userID,
            autoArtCode: '@autoArtCode',
            autoSeason: '@autoSeason',
            autoOverdue: @autoOverdue,
            autoWaitStatus: @autoWaitStatus,
            autoStatus: @autoStatus,
            autoType: @autoType
        }
    </script>
    <script src="~/Views/FactoryQuotation2Mng/index.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
    <script src="~/Angular/app/jsonService2.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
    <script src="~/Views/FactoryQuotation2Mng/service.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
}
