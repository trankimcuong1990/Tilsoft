@{
    if (ViewBag.ID == 0)
    {
        ViewBag.Title = "Create New Factory";
    }
    else
    {
        ViewBag.Title = "Edit Factory";
    }

    ViewBag.Module = "Factory";
}

<form class="row" name="editForm" id="main-form">
    <article class="col-sm-12 col-md-12 col-lg-12">
        <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
            <header>
                <ul class="nav nav-tabs pull-left in">
                    <li class="active">
                        <a data-toggle="tab" href="#tabGeneral"> <span> General Information </span> </a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#tabTracking"> <i class="fa fa-history"></i> <span> Tracking </span> </a>
                    </li>
                </ul>
            </header>
            <div>
                <div class="widget-body">
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabGeneral">
                            <div class="smart-form">
                                <fieldset>
                                    <div class="row">
                                        <section class="col col-2">
                                            <label class="label">Code</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.factoryUD" required />
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="label">Name</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.factoryName" required />
                                            </label>
                                        </section>
                                    </div>
                                    <section>
                                        <label class="label">Supplier</label>
                                        <label class="select">
                                            <select ng-model="data.supplierID" ng-options="supplier.supplierID as supplier.supplierNM for supplier in suppliers">
                                                <option value=""></option>
                                            </select>
                                            <i></i>
                                        </label>
                                    </section>
                                    <div class="row">
                                        <section class="col col-2">
                                            <label class="label">PIC</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.pic" />
                                            </label>
                                        </section>
                                        <section class="col col-2">
                                            <label class="label">Telephone</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.telephone" />
                                            </label>
                                        </section>
                                        <section class="col col-2">
                                            <label class="label">Mobile</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.mobile" />
                                            </label>
                                        </section>
                                        <section class="col col-3">
                                            <label class="label">Email</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.email" />
                                            </label>
                                        </section>
                                        <section class="col col-3">
                                            <label class="label">Website</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.website" />
                                            </label>
                                        </section>
                                    </div>
                                    <section>
                                        <label class="label">Address</label>
                                        <label class="textarea textarea-resizable">
                                            <textarea class="custom-scroll" rows="8" ng-model="data.address"></textarea>
                                        </label>
                                    </section>
                                    <div class="row">
                                        <section class="col col-6">
                                            <label class="label">City</label>
                                            <label class="input">
                                                <input type="text" ng-model="data.city" />
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="label">Location</label>
                                            <label class="select">
                                                <select ng-model="data.locationID" ng-options="location.locationID as location.locationNM for location in locations">
                                                    <option value=""></option>
                                                </select>
                                                <i></i>
                                            </label>
                                        </section>
                                    </div>
                                    <section>
                                        <label class="label">Description</label>
                                        <label class="textarea textarea-resizable">
                                            <textarea class="custom-scroll" rows="8" ng-model="data.address"></textarea>
                                        </label>
                                    </section>
                                </fieldset>
                            </div>
                        </div>
                        <div class="tab-pane" id="tabTracking">
                            <div class="smart-form">
                                <fieldset>
                                    <section class="col col-3">
                                        <label class="label">Updated By</label>
                                        <label class="input">
                                            <span class="form-control">
                                                <a ng-if="data.updatedBy" href="@Url.Action("Detail", "EmployeeMng", new { id = UrlParameter.Optional })/{{data.updatedBy}}" da data-featherlight="iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="800" data-featherlight-iframe-height="600">
                                                    <i class="fa fa-user"></i> {{data.updatorName}}
                                                </a>
                                            </span>
                                        </label>
                                    </section>
                                    <section class="col col-3">
                                        <label class="label">Updated Date</label>
                                        <label class="input">
                                            <span class="form-control">{{data.updatedDate}}</span>
                                        </label>
                                    </section>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </article>
</form>

@section FormAction {
    <ul id="sparks">
        <li class="sparks-info">
            <a href="@Url.Action("Index", "Factory")" class="btn btn-default" title="Go Back"><i class="fa fa-arrow-left"></i></a>
        </li>
        <li class="sparks-info">
            <a href="javascript:void(0)" class="btn btn-default @(Frontend.Helper.AuthHelper.GetActionButtonStatus(ViewBag.ModuleCode, Frontend.Helper.ActionEnum.Update, HttpContext.Current))" title="Save" ng-click="event.update($event)"><i class="fa fa-save"></i></a>
        </li>
        <li class="sparks-info">
            <a href="javascript:void(0)" class="btn btn-default@(ViewBag.ID==0?" disabled":"") @(Frontend.Helper.AuthHelper.GetActionButtonStatus(ViewBag.ModuleCode, Frontend.Helper.ActionEnum.Create, HttpContext.Current))" title="Delete" style="color: #ff0000;" ng-click="event.delete($event)"><i class="fa fa-times"></i></a>
        </li>
        <li class="sparks-info">
            <a href="javascript:void(0)" class="btn btn-default disabled" title="Print"><i class="fa fa-print"></i></a>
        </li>
        <li class="sparks-info">
            <a href="javascript:void(0)" class="btn btn-default disabled" title="Approve"><i class="fa fa-thumbs-o-up"></i></a>
        </li>
        <li class="sparks-info">
            <a href="javascript:void(0)" class="btn btn-default disabled" title="Reset Approval status"><i class="fa fa-thumbs-o-down"></i></a>
        </li>
    </ul>
}

@section pagejs {
    <script src="~/Angular/app/jsonService.js"></script>
    <script src="~/Angular/app/factory/service.js"></script>
    <script type="text/javascript">
        jsonService.serviceUrl = '@(System.Configuration.ConfigurationManager.AppSettings["BackendServiceUrl"])api/factory/';
        jsonService.token = '@Session[Frontend.Customize.Common.ProjectDefinition.TOKEN_SESSION]';

        var tilsoftApp = angular.module('tilsoftApp', []);
        tilsoftApp.controller('tilsoftController', ['$scope', function ($scope) {
            //
            // property
            //
            $scope.data = null;
            $scope.locations = null;
            $scope.suppliers = null;

            //
            // event
            //
            $scope.event = {
                init:function(){
                    jsonService.load(
                        @ViewBag.ID,
                        function (data) {
                            $scope.data = data.data.data;
                            $scope.locations = data.data.locations;
                            $scope.suppliers = data.data.suppliers;
                            $scope.$apply();
                            jQuery('#content').show();

                            // monitor changes
                            $scope.$watch('data', function() {
                                jQuery('#changeNotification').html('<i class="fa fa-save blink_me"></i>');
                            });
                        },
                        function (error) {
                            jsHelper.showMessage('warning', error);

                            $scope.data = null;
                            $scope.locations = null;
                            $scope.suppliers = null;
                            $scope.$apply();
                        }
                    );
                },
                update: function($event){
                    $event.preventDefault();

                    if($scope.editForm.$valid)
                    {
                        jsonService.update(
                            @ViewBag.ID,
                            $scope.data,
                            function (data) {
                                jsHelper.processMessage(data.message);
                                if(data.message.type == 0) {
                                    $scope.method.refresh(data.data.factoryID);
                                }
                            },
                            function (error) {
                                jsHelper.showMessage('warning', error);
                            }
                        );
                    }
                    else
                    {
                        jsHelper.showMessage('warning', '@Frontend.Properties.Resources.INPUT_VALIDATION_FAILED');
                    }
                },
                delete: function($event){
                    $event.preventDefault();

                    if (confirm('Are you sure ?')) {
                        jsonService.delete(
                            @ViewBag.ID,
                            function (data) {
                                jsHelper.processMessage(data.message);
                                if(data.message.type == 0) {
                                    window.location = '@Url.Action("Index", "Factory")';
                                }
                            },
                                function (error) {
                                    jsHelper.showMessage('warning', error);
                                }
                            );
                    }
                }
            };

            //
            // method
            //
            $scope.method = {
                refresh: function(id){
                    jsHelper.loadingSwitch(true);
                    window.location = '@Url.Action("Edit", "Factory", new { id = UrlParameter.Optional })/'+id;
                }
            };

            //
            // init
            //
            $scope.event.init();
        }]);
    </script>
}

