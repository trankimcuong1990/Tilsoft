@{

    ViewBag.Title = "OverView Factory Order";

    ViewBag.Module = "Overview Factory Order";

    string userManualUrl = string.Empty;
    if (System.IO.File.Exists(Server.MapPath("~/UserManual/" + ViewBag.ModuleCode + ".pdf")))
    {
        userManualUrl = "/UserManual/" + ViewBag.ModuleCode + ".pdf";
    }

    ViewBag.FactoryOrderDetailID = -1;
    if (Request.QueryString["factoryOrderDetailID"] != null)
    {
        ViewBag.FactoryOrderDetailID = Convert.ToInt32(Request.QueryString["factoryOrderDetailID"]);
    }

    ViewBag.IsDisable = Frontend.Helper.AuthHelper.GetActionButtonStatus(ViewBag.ModuleCode, Frontend.Helper.ActionEnum.Update, HttpContext.Current);
}

<div class="row">
    <form name="editForm">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12" ng-if="currentForm=='receipt-form'">
            <div class="jarviswidget" id="wid-id-general" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
                <header>
                    <ul class="nav nav-tabs pull-left in">
                        <li class="active">
                            <a data-toggle="tab" href="#hb1"> <i class="fa fa-database"></i> <span class="hidden-mobile hidden-tablet"> General Information </span> </a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#hb2"> <i class="fa fa-database"></i> <span class="hidden-mobile hidden-tablet">Tracking</span> </a>
                        </li>
                    </ul>
                </header>
                <div>
                    <div class="jarviswidget-editbox"></div>

                    <div class="widget-body">
                        <div class="tab-content">

                            <div class="tab-pane active" id="hb1">
                                <div class="row">
                                    <div class="col-sm-2 ">
                                        <label>Proforma InvoiceNo</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.proformaInvoiceNo}}</span>
                                    </div>

                                    <div class="col-sm-2">
                                        <label>Factory</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.factoryUD}}</span>
                                    </div>

                                    <div class="col-sm-2 ">
                                        <label>Order Type</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.orderTypeNM}}</span>
                                    </div>

                                    <div class="col-sm-2 ">
                                        <label>Item Standard</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.itemStandardNM}}</span>
                                    </div>

                                    <div class="col-sm-2 ">
                                        <label>Production Status</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.productionStatus}}</span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2">
                                        <label>Client No</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.clientUD}}</span>
                                    </div>

                                    <div class="col-sm-2">
                                        <label>LDS Factory</label>
                                        <div class="input-group">
                                            <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.ldS1Formated}}</span>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 ">
                                        <label>Additional Remark (SCM NL)</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.additionalRemark}}</span>
                                    </div>
                                    <div class="col-sm-2" style="display: none">
                                        <label>LDS2</label>
                                        <div class="input-group">
                                            <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.ldS2Formated}}</span>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 " style="display: none">
                                        <label>LDS3</label>
                                        <div class="input-group">
                                            <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.ldS3Formated}}</span>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 " style="display: none">
                                        <label>LDS4</label>
                                        <div class="input-group">
                                            <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.ldS4Formated}}</span>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-2 " style="display: none">
                                        <label>Supply Chain Remark</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.supplyChainRemark}}</span>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-sm-2 ">
                                        <label>Status</label>
                                        <input type="text" class="form-control" readonly ng-model="factoryOrderDataContainer.factoryOrderData.trackingStatusNM" />
                                    </div>

                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Version</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.factoryOrderVersion}}</span>
                                    </div>

                                    <div class="col-sm-2">
                                        <label>Shipper</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.shippedByFactoryUD}}</span>
                                    </div>

                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Supply chain responsible</label>
                                        <input type="text" readonly class="form-control" ng-model="factoryOrderDataContainer.factoryOrderData.supplyChainPersonNM">
                                    </div>
                                    <div class="col-sm-2 ">
                                        <label>Inspection</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.inspectionOptionNM}}</span>
                                    </div>
                                    <div class="col-sm-2 ">
                                        <label>Test Item </label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.testSamplingOptionNM}}</span>
                                    </div>
                                    <div class="col-sm-2">
                                        <label>Order Date</label>
                                        <div class="input-group">
                                            <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.orderDateFormated}}</span>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-2" style="display: none;">
                                        <label>Rating</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.rating}}</span>
                                    </div>
                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Labeling</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.labelingOptionNM}}</span>
                                    </div>
                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Packaging</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.packagingOptionNM}}</span>
                                    </div>

                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Shipment To</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.shipmentToOptionNM}}</span>
                                    </div>
                                    <div class="col-sm-2 " style="display: none;">
                                        <label>Shipment Type</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.shipmentTypeOptionNM}}</span>
                                    </div>

                                </div>
                            </div>

                            <div class="tab-pane" id="hb2">
                                <div class="row">
                                    <div class="col-sm-2 m-bottom-15">
                                        <label>Created By</label>
                                        <span class="form-control" ng-show="factoryOrderDataContainer.factoryOrderData.createdBy != null && factoryOrderDataContainer.factoryOrderData.creatorName2 != null">
                                            <a href="@Url.Action("Detail", "EmployeeMng", new { id = UrlParameter.Optional })/{{factoryOrderDataContainer.factoryOrderData.createdBy}}" da data-featherlight="iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="800" data-featherlight-iframe-height="600">
                                                <i class="fa fa-user"></i> {{factoryOrderDataContainer.factoryOrderData.creatorName2}}
                                            </a>
                                        </span>
                                        <span class="form-control" ng-show="factoryOrderDataContainer.factoryOrderData.createdBy != null && factoryOrderDataContainer.factoryOrderData.creatorName2 == null && factoryOrderDataContainer.factoryOrderData.creatorName != null">
                                            <i class="fa fa-user"></i> {{factoryOrderDataContainer.factoryOrderData.creatorName}}
                                        </span>
                                    </div>

                                    <div class="col-sm-2 m-bottom-15">
                                        <label>Created Date</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.createdDateFormated}}</span>
                                    </div>


                                    <div class="col-sm-2 m-bottom-15">
                                        <label>Updated By</label>
                                        <span class="form-control" ng-show="factoryOrderDataContainer.factoryOrderData.updatedBy != null && factoryOrderDataContainer.factoryOrderData.updatorName2 != null">
                                            <a href="@Url.Action("Detail", "EmployeeMng", new { id = UrlParameter.Optional })/{{factoryOrderDataContainer.factoryOrderData.updatedBy}}" da data-featherlight="iframe" data-featherlight-iframe-allowfullscreen="true" data-featherlight-iframe-width="800" data-featherlight-iframe-height="600">
                                                <i class="fa fa-user"></i> {{factoryOrderDataContainer.factoryOrderData.updatorName2}}
                                            </a>
                                        </span>
                                        <span class="form-control" ng-show="factoryOrderDataContainer.factoryOrderData.updatedBy != null && factoryOrderDataContainer.factoryOrderData.updatorName2 == null && factoryOrderDataContainer.factoryOrderData.updatorName != null">
                                            <i class="fa fa-user"></i> {{factoryOrderDataContainer.factoryOrderData.updatorName}}
                                        </span>
                                    </div>


                                    <div class="col-sm-2 m-bottom-15">
                                        <label>Updated Date</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.updatedDateFormated}}</span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2 m-bottom-15">
                                        <label>OMSv4 ID</label>
                                        <span class="form-control">{{factoryOrderDataContainer.factoryOrderData.v4id}}</span>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="jarviswidget" id="wid-id-general" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
                <header>
                    <ul class="nav nav-tabs pull-left in">
                        <li class="active">
                            <a data-toggle="tab" href="#hb3"> <i class="fa fa-database"></i> <span class="hidden-mobile hidden-tablet">Product</span> </a>
                        </li>
                        <li>
                            <a data-toggle="tab" href="#hb4"> <i class="fa fa-database"></i> <span class="hidden-mobile hidden-tablet">Sparepart</span> </a>
                        </li>
                    </ul>
                </header>
                <div>
                    <div class="jarviswidget-editbox"></div>

                    <div class="widget-body">
                        <div class="tab-content">

                            <div class="tab-pane active" id="hb3">
                                <div class="row">
                                    <div class="col-sm-12 m-bottom-15">
                                        <div id="factoryOrderDetailGrid" class="tilsoft-table-wrapper">
                                            <div class="tilsoft-table">
                                                <div class="tilsoft-table-header" style="width: 675px;">
                                                    <div style="width: 115px"></div>
                                                    <div class="sorting" style="width: 350px" data-colname="description">Description</div>
                                                    <div class="sorting" style="width: 80px" data-colname="saleOrderQnt">PI Qnt</div>
                                                    <div class="sorting" style="width: 80px" data-colname="orderQnt">Order Qnt</div>
                                                    <div class="sorting" style="width: 80px" data-colname="remark">Remark</div>
                                                    <div>&nbsp;</div>
                                                </div>
                                                <div class="tilsoft-table-body" style="width: 675px; ">
                                                    <table>
                                                        <tbody ng-repeat="item in factoryOrderDataContainer.factoryOrderData.factoryOrderDetails">
                                                            <tr class="{{item.isSelected?'rowselected':''}}">
                                                                <td style="width: 115px; text-align:center">
                                                                    <a style="width: 45px; float: left;" class="btn btn-default btn-xs font-11 @(Frontend.Helper.AuthHelper.GetActionButtonStatus(ViewBag.ModuleCode, Frontend.Helper.ActionEnum.Print, HttpContext.Current))" title="Print PS" href="javascript:void(0)" ng-click="printPS($event,item.factoryOrderDetailID)"><i class="fa fa-print"></i> PS</a>
                                                                    <a style="width: 45px; float: right;" class="btn btn-default btn-xs font-11" title="QC Report" ng-click="qcReport.getQCReport($event,item.factoryOrderDetailID)" href="javascript:void(0)"><i class="fa fa-bar-chart-o"></i> QC</a>
                                                                    <br style="clear: both;" />
                                                                    @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("BOMMng", Frontend.Helper.ActionEnum.Read, HttpContext.Current) != "disabled")
                                                                    {
                                                                        <a ng-if="item.bomid" style="width: 100px; margin-top: 5px;" class="btn btn-default btn-xs font-11" title="BOM" target="_blank" href="@Url.Action("Edit", "BOM", new { id = UrlParameter.Optional })/{{item.bomid}}"><i class="fa fa-codepen"></i> BOM</a>
                                                                    }

                                                                    @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("BOMStandardMng", Frontend.Helper.ActionEnum.Read, HttpContext.Current) != "disabled")
                                                                    {
                                                                        <a ng-if="!item.bomid && item.bomStandardID" style="width: 100px; margin-top: 5px;" class="btn btn-default btn-xs font-11" title="BOM" target="_blank" href="@Url.Action("Edit", "BOMStandardMng", new { id = UrlParameter.Optional })/{{item.bomStandardID}}"><i class="fa fa-codepen"></i> BOM</a>
                                                                    }

                                                                    <br ng-if="item.bomid || item.bomStandardID" />

                                                                    @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("ProductBreakDownMng", Frontend.Helper.ActionEnum.Read, HttpContext.Current) != "disabled")
                                                                    { 
                                                                        <a style="width: 100px; margin-top: 5px;" class="btn btn-default btn-xs font-11" title="Breakdown" href="javascript:void(0)" ng-click="openGeneralBreakDown(item)"><i class="fa fa-cubes"></i> Breakdown</a>
                                                                    }                                                                    
                                                                </td>
                                                                <td style="width: 350px; ">
                                                                    <strong>{{item.articleCode}}</strong>
                                                                    <br />
                                                                    {{item.description}}
                                                                </td>
                                                                <td style="width: 80px; text-align: right;">{{item.saleOrderQnt | number}}</td>
                                                                <td style="width: 80px; text-align: right;">{{item.orderQnt | number}}</td>
                                                                <td style="width: 80px">
                                                                    {{item.remark}}
                                                                </td>
                                                                <td></td>
                                                            </tr>
                                                            <tr ng-if="item.factoryOrderColliDetails.length>0">
                                                                <td></td>
                                                                <td>Colli EAN Code:</td>
                                                                <td colspan="4" style="vertical-align:middle">
                                                                    <ul style="margin-bottom:0px">
                                                                        <li ng-repeat="xItem in item.factoryOrderColliDetails" style="display:inline"><span class="badge">{{xItem.colliEANCode}}</span> </li>
                                                                    </ul>
                                                                </td>
                                                            </tr>
                                                        </tbody>

                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="hb4">
                                <div class="row">
                                    <div class="col-sm-12 m-bottom-15">
                                        <div id="factoryOrderSparepartDetailGrid" class="tilsoft-table-wrapper">
                                            <div class="tilsoft-table">
                                                <div class="tilsoft-table-header" style="width: 1200px;">
                                                    <div class="sorting" style="width: 150px;" data-colname="articleCode">Article Code</div>
                                                    <div class="sorting" style="width: 70px;" data-colname="orderQnt">Order Qnt</div>
                                                    <div class="sorting" style="width: 70px;" data-colname="totalQnt">Total Qnt</div>
                                                    <div class="sorting" style="width: 70px;" data-colname="remainQnt">Remaining Qnt</div>
                                                    <div class="sorting" data-colname="description">description</div>
                                                </div>
                                                <div class="tilsoft-table-body" style="width: 1200px;">
                                                    <table>
                                                        <tr ng-repeat="item in factoryOrderDataContainer.factoryOrderData.factoryOrderSparepartDetails">
                                                            <td style="width: 150px; ">{{item.articleCode}}</td>
                                                            <td style="width: 70px;">
                                                                <span class="form-control">{{item.orderQnt}}</span>
                                                            </td>
                                                            <td style="width: 70px;"><span class="form-control">{{item.totalQnt}}</span></td>
                                                            <td style="width: 70px;"><span class="form-control">{{item.remainQnt}}</span></td>
                                                            <td>{{item.description}}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </article>

        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12" ng-if="currentForm=='assign-colli-form'">
            <div class="jarviswidget" id="wid-id-general" data-widget-editbutton="false" data-widget-colorbutton="false" data-widget-fullscreenbutton="false" data-widget-deletebutton="false">
                <header>
                    <ul class="nav nav-tabs pull-left in">
                        <li class="active">
                            <a data-toggle="tab" href="#hb1"> <i class="fa fa-database"></i> <span class="hidden-mobile hidden-tablet">Assign Colli</span> </a>
                        </li>
                    </ul>
                </header>
                <div>
                    <div class="jarviswidget-editbox"></div>

                    <div class="widget-body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="hb1">
                                <div class="row">
                                    <div class="col-sm-6 m-bottom-15">
                                        <a class="btn btn-primary btn-xs" href="#" ng-click="assignColliForm.createFactoryOrderProductColli($event)"><i class="fa fa-plus"></i> Assign Colli</a>
                                        <a class="btn btn-danger btn-xs" href="#" ng-click="assignColliForm.cancel($event)"><i class="fa fa-times"></i> Cancel</a>
                                    </div>
                                </div>
                                <div class="row"></div>
                                <div class="row">
                                    <div class="col-sm-12">


                                        <div class="tilsoft-table">
                                            <div class="tilsoft-table-body" style="width: 100%; overflow-y: hidden; height: auto; margin-top: 0px;">
                                                <table>
                                                    <tr>
                                                        <th style="width: 110px;">Article Code</th>
                                                        <th>Description</th>
                                                        <th style="width:90px">Quantity</th>
                                                    </tr>
                                                    <tbody ng-repeat="item in assignColliForm.products">
                                                        <tr class="{{item.isSelected?'rowselected':''}}">
                                                            <td><a href="@Url.Action("Edit", "Product")/{{item.productID}}" target="_blank">{{item.articleCode}}</a></td>
                                                            <td><a href="@Url.Action("Edit", "Product")/{{item.productID}}" target="_blank">{{item.description}}</a></td>
                                                            <td style="text-align:right;vertical-align:middle">{{item.orderQnt}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td></td>
                                                            <td colspan="2">
                                                                <table>
                                                                    <tbody ng-repeat="eItem in assignColliForm.productSetEANCodes | filter : {factoryOrderDetailID : item.factoryOrderDetailID}">
                                                                        <tr>
                                                                            <td style="width:210px">
                                                                                <input type="checkbox" ng-model="eItem.isSelected" ng-click="assignColliForm.selectedEANCode(eItem.isSelected,item.factoryOrderDetailID,eItem.productSetEANCodeID)" ng-disabled="eItem.productSetEANCodeID<0 || eItem.colliEANCodeCount==0" /> EAN Code : <span class="{{eItem.productEANCode=='NONE'?'text-danger':'text-primary'}}" style="font-weight:bold">{{eItem.productEANCode}}</span>
                                                                            </td>
                                                                            <td>
                                                                                <table>
                                                                                    <tr>
                                                                                        <th style="width:30px"></th>
                                                                                        <th style="width:50px">No.</th>
                                                                                        <th style="width:150px">Colli EAN Code</th>
                                                                                        <th style="width:90px">Colli Qnt</th>
                                                                                        <th></th>
                                                                                    </tr>
                                                                                    <tbody ng-repeat="cItem in assignColliForm.productColli | filter : {factoryOrderDetailID : item.factoryOrderDetailID, productSetEANCodeID : eItem.productSetEANCodeID}">
                                                                                        <tr class="{{cItem.isSelected?'rowselected':''}}">
                                                                                            <td style="text-align:center"><input type="checkbox" ng-model="cItem.isSelected" disabled="disabled" /></td>
                                                                                            <td style="text-align:center;vertical-align:middle">{{cItem.rowIndex}}</td>
                                                                                            <td style="text-align:center;vertical-align:middle"><span class="{{cItem.colliEANCode=='NONE'?'text-danger':'text-primary'}}">{{cItem.colliEANCode}}</span></td>
                                                                                            <td style="text-align:center;vertical-align:middle">{{item.orderQnt}}</td>
                                                                                            <td></td>
                                                                                        </tr>
                                                                                    </tbody>
                                                                                </table>
                                                                            </td>
                                                                        </tr>

                                                                    </tbody>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </article>
    </form>

    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="frmQCReport" class="modal fade" style="display: none;">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                        ×
                    </button>
                    <h4 id="myModalLabel" class="modal-title">QC Report</h4>
                </div>
                <div class="modal-body smart-form">
                    <fieldset>
                        <div class="row">
                            <section class="col col-lg-12">
                                <div class="tilsoft-table">
                                    <div class="tilsoft-table-body" style="width:520px; height:auto;margin-top:0px">
                                        <table>
                                            <tr>
                                                <th>QC report file</th>
                                                <th style="width:120px">Updated By</th>
                                                <th style="width:100px">Updated Date</th>
                                                <th style="width:180px">Remark</th>
                                            </tr>
                                            <tr ng-repeat="item in qcReport.data">
                                                <td>
                                                    <a href="{{item.fileLocation}}" target="_blank">{{item.friendlyName}}</a>
                                                </td>
                                                <td>{{item.updatorName}}</td>
                                                <td style="text-align:center">{{item.updatedDate}}</td>
                                                <td>{{item.remark}}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>


    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="frmGeneralBreakDown" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="margin-top:90px !important">
                <div class="modal-header">
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                        ×
                    </button>
                    <h4 class="modal-title">General BreakDown</h4>
                </div>
                <div class="modal-body smart-form" style="padding: 0px;">
                    <div>
                        <div class="widget-body">
                            <table class="table table-bordered table-striped" style="box-sizing: border-box;">
                                <thead>
                                    <tr>
                                        <th>Model</th>
                                        <th>Size</th>
                                        <th>Frame</th>
                                        <th>Cushion</th>
                                        <th>Carton</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="item in data.generalBreakDownData">
                                        <td>
                                            @if (Frontend.Helper.AuthHelper.GetActionButtonStatus("ProductBreakDownMng", Frontend.Helper.ActionEnum.Read, HttpContext.Current) != "disabled")
                                            {
                                                <a href="@Url.Action("Edit", "ProductBreakDownMng", new { id = UrlParameter.Optional })/{{item.productBreakDownID}}" target="_blank">
                                                    <strong>{{item.modelUD}}</strong>
                                                    <br />
                                                    {{item.modelNM}}
                                                </a>
                                            }
                                            else
                                            {
                                                <text>
                                                    <strong>{{item.modelUD}}</strong>
                                                    <br />
                                                    {{item.modelNM}}
                                                </text>
                                            }
                                        </td>
                                        <td>{{item.itemSize}}</td>
                                        <td>{{item.frameDescription}}</td>
                                        <td>{{item.cushionDescription}}</td>
                                        <td>{{item.cartonSize}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>



@section FormAction {
<ul id="sparks">
    <li class="sparks-info">
        <a href="@Url.Action("FaO", "FactoryOrder")/@ViewBag.SaleOrderID/{{factoryOrderDataContainer.factoryOrderData.offerID}}" class="btn btn-default" title="Go Back"><i class="fa fa-arrow-left"></i></a>
    </li>
    <li class="sparks-info">
        <a href="@Url.Action("Edit", "FactoryOrder")/@ViewBag.ID/@ViewBag.SaleOrderID" class="btn btn-default @(ViewBag.ID==0?" disabled":"") @(Frontend.Helper.AuthHelper.GetActionButtonStatus(ViewBag.ModuleCode, Frontend.Helper.ActionEnum.Update, HttpContext.Current))" title="Edit"><i class="fa fa-pencil"></i></a>
    </li>
    @if (!string.IsNullOrEmpty(userManualUrl))
    {
        <li class="sparks-info">
            <a target="_blank" href="@userManualUrl" class="btn btn-default" title="Help"><i class="fa fa-info"></i></a>
        </li>
    }
</ul>
}

@section pagejs {
    <script src="~/Angular/app/factoryorder/service.js?c=@System.Guid.NewGuid().ToString().Replace("-", "")"></script>
    <script type="text/javascript">

        var factoryOrderDetailGrid = jQuery('#factoryOrderDetailGrid').scrollableTable(null,function(sortedBy, sortedDirection){
            var scope = angular.element(jQuery('body')).scope();
            datasource = scope.factoryOrderDataContainer.factoryOrderData.factoryOrderDetails;
            if (sortedDirection == 'asc') {
                datasource.sort(function(a,b){
                    return a[sortedBy] > b[sortedBy] ? 1: -1;
                });
            }
            else if (sortedDirection == 'desc') {
                datasource.sort(function(a,b){
                    return a[sortedBy] < b[sortedBy] ? 1: -1;
                });
            }
            scope.$apply();
        });

        var factoryOrderSparepartDetailGrid = jQuery('#factoryOrderSparepartDetailGrid').scrollableTable(null,function(sortedBy, sortedDirection){
            var scope = angular.element(jQuery('body')).scope();
            datasource = scope.factoryOrderDataContainer.factoryOrderData.factoryOrderSparepartDetails;
            if (sortedDirection == 'asc') {
                datasource.sort(function(a,b){
                    return a[sortedBy] > b[sortedBy] ? 1: -1;
                });
            }
            else if (sortedDirection == 'desc') {
                datasource.sort(function(a,b){
                    return a[sortedBy] < b[sortedBy] ? 1: -1;
                });
            }
            scope.$apply();
        });

        factoryOrderService.serviceUrl = '@(System.Configuration.ConfigurationManager.AppSettings["BackendServiceUrl"])api/factoryorder/';
        factoryOrderService.token = '@Session[Frontend.Customize.Common.ProjectDefinition.TOKEN_SESSION]';
        var saleorderApp = angular.module('tilsoftApp', []);
        saleorderApp.controller('tilsoftController', ['$scope', function ($scope) {
            $scope.factoryOrderDataContainer = null;
            $scope.data = {
                generalBreakDownData: null
            };
            $scope.currentForm='receipt-form';
            $scope.load = function()
            {
                $scope.factoryorderdata = null;
                $scope.pageIndex = 1;
                $scope.totalPage = 0;


                $scope.disabled = false;

                factoryOrderService.getOverView(@ViewBag.ID, @ViewBag.SaleOrderID,
                    function (data) {
                        $scope.factoryOrderDataContainer = data.data; console.log(data);
                        //assing product is selected when naviage from Credit note
                        angular.forEach($scope.factoryOrderDataContainer.factoryOrderData.factoryOrderDetails,function(item){
                            item.isSelected=(item.factoryOrderDetailID==@ViewBag.FactoryOrderDetailID);
                        });
                        //debugger;
                        if ('@ViewBag.IsDisable' === 'disabled'){
                            $scope.disabled = true;
                        } else {
                            $scope.disabled = false;
                        }

                        //show html
                        jQuery('#content').show();
                        $scope.$apply();
                    },
                    function (error) {
                        jsHelper.showMessage('warning', error);
                        $scope.factoryOrderDataContainer = null;
                        $scope.$apply();
                    }
                );
            }
   
            $scope.openGeneralBreakDown = function (item) {
                $scope.data.generalBreakDownData = null;
                factoryOrderService.getGeneralBreakDown(
                    item.modelID,
                    function (data) {
                        if (data.message.type === 0) {
                            $scope.data.generalBreakDownData = data.data;
                            $scope.$apply();
                            $('#frmGeneralBreakDown').modal();
                        }
                    },
                    function (error) {
                        jsHelper.showMessage('warning', error.message.message);
                        $scope.$apply();
                    }
                );
            };


            $scope.printPS = function ($event, factoryOrderDetailID) {
                $event.preventDefault();
                factoryOrderService.serviceUrl = '@(System.Configuration.ConfigurationManager.AppSettings["BackendServiceUrl"])';
                factoryOrderService.printPS(factoryOrderDetailID,
                    function (data) {
                        //jsHelper.processMessage(data.message);
                        if (data.message.type != 2)
                        {
                            window.location = '@System.Configuration.ConfigurationManager.AppSettings["BackendReportUrl"]' + data.data;
                        }
                    },
                    function (error) {
                        jsHelper.showMessage('warning', error);
                    }
                );
                factoryOrderService.serviceUrl = '@(System.Configuration.ConfigurationManager.AppSettings["BackendServiceUrl"])api/factoryorder/';
            }



            $scope.qcReport = {
                data : null,
                getQCReport : function($event, factoryOrderDetailID) {
                    factoryOrderService.getQCReport(factoryOrderDetailID
                        ,function(data){
                            $scope.qcReport.data = data.data;
                            $scope.$apply();
                            $('#frmQCReport').modal('show');
                        }
                        ,function(error){
                            jsHelper.showMessage('warning', error);
                        })
                }

            }
          

            //load form
            $scope.load();
        }]);

    </script>
}

